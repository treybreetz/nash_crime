<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.4">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Call Locations&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- Include Leaflet library --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body, html {</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin: 0;</p>
<p class="p1"><span class="Apple-converted-space">            </span>overflow: hidden;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>#map {</p>
<p class="p1"><span class="Apple-converted-space">            </span>height: 100%;</p>
<p class="p1"><span class="Apple-converted-space">            </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.filter-container {</p>
<p class="p1"><span class="Apple-converted-space">            </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">            </span>top: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>left: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>z-index: 1000;</p>
<p class="p1"><span class="Apple-converted-space">            </span>background-color: rgba(255, 255, 255, 0.8); /* Slightly opaque white background */</p>
<p class="p1"><span class="Apple-converted-space">            </span>padding: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>border-radius: 5px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.filter-checkbox {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-bottom: 5px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 0.8; /* Adjust opacity */</p>
<p class="p1"><span class="Apple-converted-space">            </span>transform: scale(0.8); /* Adjust size */</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.filter-label {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-right: 5px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>font-size: 12px; /* Adjust font size */</p>
<p class="p1"><span class="Apple-converted-space">            </span>opacity: 0.8; /* Adjust opacity */</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>.select-button {</p>
<p class="p1"><span class="Apple-converted-space">            </span>margin-top: 10px;</p>
<p class="p1"><span class="Apple-converted-space">            </span>cursor: pointer;</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="map"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="filter-container" class="filter-container"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"&gt;&lt;/script&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let map;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let markers = [];</p>
<p class="p1"><span class="Apple-converted-space">        </span>let filterContainer = document.getElementById('filter-container');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Fetch data from the JSON API</p>
<p class="p1"><span class="Apple-converted-space">        </span>fetch('https://data.nashville.gov/resource/qywv-8sc2.json')</p>
<p class="p1"><span class="Apple-converted-space">            </span>.then(response =&gt; response.json())</p>
<p class="p1"><span class="Apple-converted-space">            </span>.then(data =&gt; initializeMap(data))</p>
<p class="p1"><span class="Apple-converted-space">            </span>.catch(error =&gt; console.error('Error fetching data:', error));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function initializeMap(data) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>// Initialize the map</p>
<p class="p1"><span class="Apple-converted-space">            </span>map = L.map('map').setView([36.1627, -86.7816], 12);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Add a tile layer (you can choose different providers)</p>
<p class="p1"><span class="Apple-converted-space">            </span>L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {</p>
<p class="p1"><span class="Apple-converted-space">                </span>attribution: '&amp;copy; OpenStreetMap contributors'</p>
<p class="p1"><span class="Apple-converted-space">            </span>}).addTo(map);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Add markers to the map</p>
<p class="p1"><span class="Apple-converted-space">            </span>data.forEach((call) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const address = call.full_address;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Geocode address to get latitude and longitude</p>
<p class="p1"><span class="Apple-converted-space">                </span>fetch(`https://nominatim.openstreetmap.org/search?format=json&amp;q=${encodeURIComponent(address)}`)</p>
<p class="p1"><span class="Apple-converted-space">                    </span>.then(response =&gt; response.json())</p>
<p class="p1"><span class="Apple-converted-space">                    </span>.then(geoData =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                        </span>if (geoData &amp;&amp; geoData.length &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const latitude = parseFloat(geoData[0].lat);</p>
<p class="p1"><span class="Apple-converted-space">                            </span>const longitude = parseFloat(geoData[0].lon);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                            </span>// Check if latitude and longitude are valid numbers</p>
<p class="p1"><span class="Apple-converted-space">                            </span>if (!isNaN(latitude) &amp;&amp; !isNaN(longitude)) {</p>
<p class="p1"><span class="Apple-converted-space">                                </span>const marker = L.marker([latitude, longitude]).addTo(map);</p>
<p class="p1"><span class="Apple-converted-space">                                </span>markers.push(marker);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                                </span>// Add popup with information to each marker</p>
<p class="p1"><span class="Apple-converted-space">                                </span>marker.bindPopup(`</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;b&gt;Address:&lt;/b&gt; ${address}&lt;br&gt;</p>
<p class="p1"><span class="Apple-converted-space">                                    </span>&lt;b&gt;Tencode Description:&lt;/b&gt; ${call.description}</p>
<p class="p1"><span class="Apple-converted-space">                                </span>`);</p>
<p class="p1"><span class="Apple-converted-space">                            </span>}</p>
<p class="p1"><span class="Apple-converted-space">                        </span>}</p>
<p class="p1"><span class="Apple-converted-space">                    </span>})</p>
<p class="p1"><span class="Apple-converted-space">                    </span>.catch(error =&gt; console.error('Error geocoding address:', error));</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Create filter checkboxes</p>
<p class="p1"><span class="Apple-converted-space">            </span>createFilterCheckboxes();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>// Add select/deselect buttons</p>
<p class="p1"><span class="Apple-converted-space">            </span>createSelectButtons();</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function createFilterCheckboxes() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const uniqueDescriptions = [...new Set(markers.map(marker =&gt; marker.getPopup().getContent().match(/Description:&lt;\/b&gt; (.*)/)[1]))];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>uniqueDescriptions.forEach((description) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const checkbox = document.createElement('input');</p>
<p class="p1"><span class="Apple-converted-space">                </span>checkbox.type = 'checkbox';</p>
<p class="p1"><span class="Apple-converted-space">                </span>checkbox.checked = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>checkbox.id = description;</p>
<p class="p1"><span class="Apple-converted-space">                </span>checkbox.className = 'filter-checkbox';</p>
<p class="p1"><span class="Apple-converted-space">                </span>checkbox.addEventListener('change', toggleMarkers);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>const label = document.createElement('label');</p>
<p class="p1"><span class="Apple-converted-space">                </span>label.htmlFor = description;</p>
<p class="p1"><span class="Apple-converted-space">                </span>label.textContent = description;</p>
<p class="p1"><span class="Apple-converted-space">                </span>label.className = 'filter-label';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>filterContainer.appendChild(checkbox);</p>
<p class="p1"><span class="Apple-converted-space">                </span>filterContainer.appendChild(label);</p>
<p class="p1"><span class="Apple-converted-space">                </span>filterContainer.appendChild(document.createElement('br'));</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function createSelectButtons() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const selectAllButton = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">            </span>selectAllButton.textContent = 'Select All';</p>
<p class="p1"><span class="Apple-converted-space">            </span>selectAllButton.className = 'select-button';</p>
<p class="p1"><span class="Apple-converted-space">            </span>selectAllButton.addEventListener('click', () =&gt; toggleAllCheckboxes(true));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>const deselectAllButton = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">            </span>deselectAllButton.textContent = 'Deselect All';</p>
<p class="p1"><span class="Apple-converted-space">            </span>deselectAllButton.className = 'select-button';</p>
<p class="p1"><span class="Apple-converted-space">            </span>deselectAllButton.addEventListener('click', () =&gt; toggleAllCheckboxes(false));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>filterContainer.appendChild(selectAllButton);</p>
<p class="p1"><span class="Apple-converted-space">            </span>filterContainer.appendChild(deselectAllButton);</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function toggleMarkers() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>markers.forEach((marker) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const popupContent = marker.getPopup().getContent();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const description = popupContent.match(/Description:&lt;\/b&gt; (.*)/)[1];</p>
<p class="p1"><span class="Apple-converted-space">                </span>const checkbox = document.getElementById(description);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// Toggle marker visibility based on checkbox state</p>
<p class="p1"><span class="Apple-converted-space">                </span>marker.setOpacity(checkbox.checked ? 1 : 0);</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>function toggleAllCheckboxes(checked) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>const checkboxes = document.querySelectorAll('.filter-checkbox');</p>
<p class="p1"><span class="Apple-converted-space">            </span>checkboxes.forEach((checkbox) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                </span>checkbox.checked = checked;</p>
<p class="p1"><span class="Apple-converted-space">            </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>toggleMarkers(); // Update marker visibility based on the updated checkbox states</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
